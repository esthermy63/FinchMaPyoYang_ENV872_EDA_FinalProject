---
output: html_document
editor_options: 
  chunk_output_type: console
---
\newpage
\tableofcontents 
\newpage
\listoftables 
\newpage
\listoffigures 
\newpage

```{r setup, include=FALSE}
# Set your working directory
# Load packages
getwd()
library(tidyverse)
library(sf)
library(ggplot2)
library(mapview)
library(leaflet)

# I'll move the codes to other sections later --Yike
flood <- disasters %>% 
  filter(incidentType == "Flood") %>% 
  select(c(state:incidentType), fipsStateCode,fipsCountyCode) %>% 
  filter(fyDeclared %in% c(1990:2025)) %>% 
  arrange(state)

#convert FIDs into 5 digits
#counties$GEOID <- as.numeric(as.character(counties$GEOID))
states$STATEFP <- as.numeric(as.character(states$STATEFP))
flood.spatial <- left_join(flood, states, by = c("fipsStateCode" = "STATEFP"))
summary(flood.spatial) # 113 NAs because some data are located at state level instead of county level.

#clean the spatial data
st_crs(states)$epsg #4269
flood.spatial <- flood.spatial %>% 
  select(state,declarationDate,fyDeclared, incidentType, fipsStateCode, 
        fipsCountyCode, NAME, geometry) %>% 
  #na.omit() %>% 
  st_as_sf(crs = 4269)


mapview(flood.spatial)

ggplot(flood.spatial,aes(x = state))+
  geom_bar()
#Minnesota has the highest count of flood - ~471 in the past 25 years


leaflet(st_centroid(flood.spatial)) %>% 
  addTiles() %>% 
  addMarkers(
    clusterOptions = markerClusterOptions()
  )


NY <- flood.spatial %>% 
  filter(state == 'NY')

NY$fyDeclared <- as.factor(NY$fyDeclared)
ggplot(NY,aes(x=fyDeclared))+
  geom_bar()

summary(NY)
```

```{r} 
# Read the dataframes
census_processed<- read.csv("Data/census_processed(2020-2024).csv", stringsAsFactors = T)
census_processed<- read.csv("Data/census_processed(2020-2024).csv",stringsAsFactors = T)
census_processed <- census_processed %>% 
  mutate(MEAN = rowMeans(across(X2020:X2024)))
substring(census_processed$State, 2, nchar(census_processed))
colnames(census_processed) <- c("State","2020","2021","2022","2023","2024")

Energy_investment<- read.csv("Data/Energy_investment_by_county.csv", stringsAsFactors = T)

disasters <- read.csv("./Data/DisasterDeclarationsSummaries.csv", stringsAsFactors = T)


#Disaster dataset: https://www.fema.gov/openfema-data-page/disaster-declarations-summaries-v2

states <- st_read("./Data/Spatial/cb_2018_us_state_20m.shp", stringsAsFactors = T)

census_2021 <- read.csv("Data/ACSSPP1Y2021.S0201-2025-11-29T154845.csv", stringsAsFactors = T)

census_2022 <- read.csv("Data/ACSSPP1Y2022.S0201-2025-11-29T154817.csv", stringsAsFactors = T)

census_2023 <- read.csv("Data/ACSSPP1Y2023.S0201-2025-11-29T154759.csv", stringsAsFactors = T)

census_2024 <- read.csv("Data/ACSSPP1Y2024.S0201-2025-11-29T154742.csv", stringsAsFactors = T)
```

```{r data mingling }
census_2021 <- census_2021 %>%
  mutate(year=2021)
census_2022 <- census_2022 %>%
  mutate(year=2022)
census_2023 <- census_2023 %>%
  mutate(year=2023)
census_2024 <- census_2024 %>%
  mutate(year=2024)


#census_2021.columns = census_2021.columns.str.replace(' ','')
census2021 <- as.data.frame(t(census_2021))
colnames(census2021) <-c(census2021[1,])

census2021 <- census2021[-1,]
census2021clean <- census2021[-c(seq(2,length(census2021),2)),]

colnames(census2021clean) <- str_trim(colnames(census2021clean))

rownames(census2021clean) <- str_sub(rownames(census2021clean), end =-29)
#rownames(census2021clean) <- gsub("."," ", rownames(census2021clean))

census2021clean <- census2021clean %>% 
  select("Total population", "Male", "Female", "Under 5 years", "5 to 17 years", "Median age (years)", "Median household income (dollars)", "Occupied housing units","Gas", "Electricity","All other fuels","No fuel used") %>% 
  mutate(year = 2021, State = rownames(census2021clean)) #%>% 
  #mutate(State = sub("."," ", State)) # Remove the dots in State names

```

# Rationale and Research Questions



\newpage

# Dataset Information



\newpage

# Exploratory Analysis 



\newpage

# Analysis



## Question 1: <insert specific question here and add additional subsections for additional questions below, if needed>

## Question 2: 




\newpage

# Summary and Conclusions


\newpage

# References
<add references here if relevant, otherwise delete this section> 
