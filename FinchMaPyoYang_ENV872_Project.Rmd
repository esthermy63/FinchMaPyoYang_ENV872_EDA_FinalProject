---
title: "What Drives Federal Energy and Environment Investment? A 2021-2024 Analytic Perspective"
author: "E. Yang, Y. Ma, J. Pyo, M. Finch"
date: "`r Sys.Date()`"
output: 
  html_document:
  toc: true
  toc_depth: 3
editor_options:
  chunk_output_type: console
---

```{=tex}
\listoftables 
\listoffigures
```
<body style="background-color:lightblue;">

*Github*: <https://github.com/esthermy63/FinchMaPyoYang_ENV872_EDA_FinalProject.git>

```{r setup, include=FALSE}
# Set your working directory
# Load packages
getwd()
library(tidyverse)
library(sf)
library(ggplot2)
library(dplyr)
library(mapview)
library(leaflet)
library("GGally")
library(readxl)
library(RColorBrewer)
library(knitr)
library(here)
#install.packages("gtsummary")
library(gtsummary)
library(broom)

# Set theme
mytheme <- theme_classic(base_size = 14) +
  theme(axis.text = element_text(color = "black", size = 9), 
        legend.position = "top")
theme_set(mytheme)

```

```{r message=FALSE, warning=FALSE, include=FALSE}
#Federal Energy and Environment investment data by state 
Investment_state <- read.csv("Data/Raw/Federal energy and environment spending by STATE (2010-2025).csv", stringsAsFactors = T)

#Natural disaster data
disasters <- read.csv("Data/Raw/DisasterDeclarationsSummaries.csv", stringsAsFactors = T)

#spatial data
states <- st_read("Data/Spatial/cb_2018_us_state_20m.shp", stringsAsFactors = T)

# Read in census data
census_2021 <- read.csv("Data/Raw/Census/ACSSPP1Y2021.S0201-2025-11-29T154845.csv", stringsAsFactors = T)
census_2022 <- read.csv("Data/Raw/Census/ACSSPP1Y2022.S0201-2025-11-29T154817.csv", stringsAsFactors = T)
census_2023 <- read.csv("Data/Raw/Census/ACSSPP1Y2023.S0201-2025-11-29T154759.csv", stringsAsFactors = T)
census_2024 <- read.csv("Data/Raw/Census/ACSSPP1Y2024.S0201-2025-11-29T154742.csv", stringsAsFactors = T)

#Regulate dataset
Regulate <- read_excel("Data/Raw/Regulate_percentage(2021~2024).xlsx")
```

```{r warning=FALSE, include=FALSE}
#Data Wrangling (for 2021)
##Clean the data

#census_2021.columns = census_2021.columns.str.replace(' ','')
census2021 <- as.data.frame(t(census_2021))
colnames(census2021) <-c(census2021[1,])

census2021clean <- census2021[-1,]
#census2021clean <- census2021[-c(seq(2,length(census2021),2)),]

colnames(census2021clean) <- str_trim(colnames(census2021clean))

rownames(census2021clean) <- str_sub(rownames(census2021clean), end =-29)
#rownames(census2021clean) <- gsub("."," ", rownames(census2021clean))

census2021clean <- census2021clean %>% 
  select("Total population", "Male", "Female", "Under 5 years", "5 to 17 years", "Median age (years)", "Median household income (dollars)","Gas", "Electricity","All other fuels","No fuel used") %>% 
  mutate(year = 2021, State = rownames(census2021clean))
  #mutate(State = sub("."," ", State)) # Remove the dots in State names
census2021clean$State <- gsub( "\\."," ",census2021clean$State)

census2021clean$`Total population` <- as.numeric(str_trim(census2021clean$`Total population`))
census2021clean$`Male` <- as.numeric(str_trim(census2021clean$`Male`))
census2021clean$Female <- as.numeric(str_trim(census2021clean$`Female`))
census2021clean$`Under 5 years` <- as.numeric(str_trim(census2021clean$`Under 5 years`))
census2021clean$`5 to 17 years` <- as.numeric(str_trim(census2021clean$`5 to 17 years`))
census2021clean$`Median age (years)` <- as.numeric(str_trim(census2021clean$`Median age (years)`))
census2021clean$`Median household income (dollars)` <- as.numeric(str_trim(census2021clean$`Median household income (dollars)`))

census2021clean$Gas <- as.numeric(str_trim(census2021clean$Gas))
census2021clean$Electricity <- as.numeric(str_trim(census2021clean$Electricity))
census2021clean$`All other fuels` <- as.numeric(str_trim(census2021clean$`All other fuels`))
census2021clean$`No fuel used` <- as.numeric(str_trim(census2021clean$`No fuel used`))


#add column for children ages 0-17 

census2021clean <- census2021clean%>%
  mutate(child=`Under 5 years` + `5 to 17 years`)


## Energy dataset (State Level)
  
Investment_state_2021 <- Investment_state %>% 
  select("STATEFP","stname", "stusps","TotalFedAction_EnergyEnv_2021","TotalFedAction_2021")
Investment_state_2021$TotalFedAction_EnergyEnv_2021 <- 
gsub("\\$ ", "", Investment_state_2021$TotalFedAction_EnergyEnv_2021)
Investment_state_2021$TotalFedAction_2021 <- 
gsub("\\$ ", "", Investment_state_2021$TotalFedAction_2021)
Investment_state_2021 <- Investment_state_2021 %>% 
  mutate(TotalFedAction_EnergyEnv_2021 =
           as.numeric(
             gsub(",", "", trimws(TotalFedAction_EnergyEnv_2021)))
         ) %>% 
  mutate(TotalFedAction_2021 =
           as.numeric(
             gsub(",", "", trimws(TotalFedAction_2021)))
         ) %>% 
  mutate(Ratio = TotalFedAction_EnergyEnv_2021/TotalFedAction_2021,
         Year = 2021)


#Disaster
states_names <- data.frame(abbrev = states$STUSPS,
                           State = states$NAME) 
#The disaster data set has only abbreviation for states, so full names need to be joined from other dataset.

#summarize disaster count by state
disaster2021 <- disasters %>% 
  filter(fyDeclared %in% c(2021)) %>% 
  arrange(state) %>% 
  group_by(state, fipsStateCode) %>% 
  summarise(Disasters = n())

disaster2021 <- left_join(disaster2021, states_names, by = c("state" = "abbrev"))

#Public awareness
Regulate2021 <- Regulate %>% 
  select("GeoName","2021")


#Combining all the variables (Demographic, disaster and public awareness)
combined2021 <- left_join(census2021clean, Investment_state_2021, by = c("State" = "stname"))

combined2021 <- left_join(combined2021, disaster2021, by = c("State" = "State"))

combined2021 <- left_join(combined2021, Regulate2021, by = c("State" = "GeoName"))



write.csv(combined2021, file = "Data/Processed/combined2021.csv")
```

```{r warning=FALSE, include=FALSE}
#Data Wrangling (for 2022)
##Clean the data

census2022 <- as.data.frame(t(census_2022))
colnames(census2022) <- c(census2022[1,])

census2022clean <- census2022[-1,]

colnames(census2022clean) <- str_trim(colnames(census2022clean))
rownames(census2022clean) <- str_sub(rownames(census2022clean), end = -29)
census2022clean <- census2022clean[seq(1, nrow(census2022clean), by = 2),]

census2022clean <- census2022clean %>% 
  select("Total population", "Male", "Female", "Under 5 years", "5 to 17 years",
         "Median age (years)", "Median household income (dollars)",
         "Gas", "Electricity", "All other fuels", "No fuel used") %>% 
  mutate(year = 2022, State = rownames(census2022clean))

census2022clean$State <- gsub("\\.", " ", census2022clean$State)

# Numeric conversions
cols_to_num <- c("Total population","Male","Female","Under 5 years","5 to 17 years",
                 "Median age (years)","Median household income (dollars)",
                 "Gas","Electricity","All other fuels","No fuel used")

census2022clean[cols_to_num] <- lapply(census2022clean[cols_to_num],
                                       function(x) as.numeric(str_trim(x)))

# Child column
census2022clean <- census2022clean %>%
  mutate(child = `Under 5 years` + `5 to 17 years`)


## Energy dataset (State Level)
Investment_state_2022 <- Investment_state %>% 
  select("STATEFP","stname","stusps",
         "TotalFedAction_EnergyEnv_2022","TotalFedAction_2022")

Investment_state_2022$TotalFedAction_EnergyEnv_2022 <- 
  gsub("\\$ ", "", Investment_state_2022$TotalFedAction_EnergyEnv_2022)

Investment_state_2022$TotalFedAction_2022 <- 
  gsub("\\$ ", "", Investment_state_2022$TotalFedAction_2022)

Investment_state_2022 <- Investment_state_2022 %>% 
  mutate(TotalFedAction_EnergyEnv_2022 =
           as.numeric(gsub(",", "", trimws(TotalFedAction_EnergyEnv_2022)))) %>% 
  mutate(TotalFedAction_2022 =
           as.numeric(gsub(",", "", trimws(TotalFedAction_2022)))) %>% 
  mutate(Ratio = TotalFedAction_EnergyEnv_2022 / TotalFedAction_2022,
         Year = 2022)


#Disaster
states_names <- data.frame(abbrev = states$STUSPS,
                           State = states$NAME)

disaster2022 <- disasters %>% 
  filter(fyDeclared %in% c(2022)) %>% 
  arrange(state) %>% 
  group_by(state, fipsStateCode) %>% 
  summarise(Disasters = n())

disaster2022 <- left_join(disaster2022, states_names, by = c("state" = "abbrev"))

#Public awareness
Regulate2022 <- Regulate %>% 
  select("GeoName","2022")


#Combined dataset
combined2022 <- left_join(census2022clean, Investment_state_2022,
                          by = c("State" = "stname"))

combined2022 <- left_join(combined2022, disaster2022,
                          by = c("State" = "State"))

combined2022 <- left_join(combined2022, Regulate2022,
                          by = c("State" = "GeoName"))

write.csv(combined2022, file = "Data/Processed/combined2022.csv")

```

```{r warning=FALSE, include=FALSE}
# Data Wrangling (for 2023)
## Clean the data

census2023 <- as.data.frame(t(census_2023))
colnames(census2023) <- c(census2023[1,])
census2023clean <- census2023[-1,]

colnames(census2023clean) <- str_trim(colnames(census2023clean))
rownames(census2023clean) <- str_sub(rownames(census2023clean), end = -29)
census2023clean <- census2023clean[seq(1, nrow(census2023clean), by = 2),]

census2023clean <- census2023clean %>% 
  select("Total population", "Male", "Female", "Under 5 years", "5 to 17 years",
         "Median age (years)", "Median household income (dollars)",
         "Gas", "Electricity", "All other fuels", "No fuel used") %>% 
  mutate(year = 2023, State = rownames(census2023clean))

census2023clean$State <- gsub("\\.", " ", census2023clean$State)

# Numeric conversions
cols_to_num <- c("Total population","Male","Female","Under 5 years","5 to 17 years",
                 "Median age (years)","Median household income (dollars)",
                 "Gas","Electricity","All other fuels","No fuel used")

census2023clean[cols_to_num] <- lapply(census2023clean[cols_to_num],
                                       function(x) as.numeric(str_trim(x)))

# Child column
census2023clean <- census2023clean %>%
  mutate(child = `Under 5 years` + `5 to 17 years`)


## Energy dataset (State Level)
Investment_state_2023 <- Investment_state %>% 
  select("STATEFP","stname","stusps",
         "TotalFedAction_EnergyEnv_2023","TotalFedAction_2023")

Investment_state_2023$TotalFedAction_EnergyEnv_2023 <- 
  gsub("\\$ ", "", Investment_state_2023$TotalFedAction_EnergyEnv_2023)
Investment_state_2023$TotalFedAction_2023 <- 
  gsub("\\$ ", "", Investment_state_2023$TotalFedAction_2023)

Investment_state_2023 <- Investment_state_2023 %>% 
  mutate(TotalFedAction_EnergyEnv_2023 =
           as.numeric(gsub(",", "", trimws(TotalFedAction_EnergyEnv_2023)))) %>% 
  mutate(TotalFedAction_2023 =
           as.numeric(gsub(",", "", trimws(TotalFedAction_2023)))) %>% 
  mutate(Ratio = TotalFedAction_EnergyEnv_2023 / TotalFedAction_2023,
         Year = 2023)


# Disaster
states_names <- data.frame(abbrev = states$STUSPS,
                           State = states$NAME)

disaster2023 <- disasters %>% 
  filter(fyDeclared %in% c(2023)) %>% 
  arrange(state) %>% 
  group_by(state, fipsStateCode) %>% 
  summarise(Disasters = n())

disaster2023 <- left_join(disaster2023, states_names, by = c("state" = "abbrev"))

# Public awareness
Regulate2023 <- Regulate %>% 
  select("GeoName","2023")


# Combined dataset
combined2023 <- left_join(census2023clean, Investment_state_2023,
                          by = c("State" = "stname"))

combined2023 <- left_join(combined2023, disaster2023,
                          by = c("State" = "State"))

combined2023 <- left_join(combined2023, Regulate2023,
                          by = c("State" = "GeoName"))

write.csv(combined2023, file = "Data/Processed/combined2023.csv")

```

```{r warning=FALSE, include=FALSE}
# Data Wrangling (for 2024)
## Clean the data

census2024 <- as.data.frame(t(census_2024))
colnames(census2024) <- c(census2024[1,])
census2024clean <- census2024[-1,]

colnames(census2024clean) <- str_trim(colnames(census2024clean))
rownames(census2024clean) <- str_sub(rownames(census2024clean), end = -29)
census2024clean <- census2024clean[seq(1, nrow(census2024clean), by = 2),]

census2024clean <- census2024clean %>% 
  select("Total population", "Male", "Female", "Under 5 years", "5 to 17 years",
         "Median age (years)", "Median household income (dollars)",
         "Gas", "Electricity", "All other fuels", "No fuel used") %>% 
  mutate(year = 2024, State = rownames(census2024clean))

census2024clean$State <- gsub("\\.", " ", census2024clean$State)

# Numeric conversions
cols_to_num <- c("Total population","Male","Female","Under 5 years","5 to 17 years",
                 "Median age (years)","Median household income (dollars)",
                 "Gas","Electricity","All other fuels","No fuel used")

census2024clean[cols_to_num] <- lapply(census2024clean[cols_to_num],
                                       function(x) as.numeric(str_trim(x)))

# Child column
census2024clean <- census2024clean %>%
  mutate(child = `Under 5 years` + `5 to 17 years`)


## Energy dataset (State Level)
Investment_state_2024 <- Investment_state %>% 
  select("STATEFP","stname","stusps",
         "TotalFedAction_EnergyEnv_2024","TotalFedAction_2024")

Investment_state_2024$TotalFedAction_EnergyEnv_2024 <- 
  gsub("\\$ ", "", Investment_state_2024$TotalFedAction_EnergyEnv_2024)
Investment_state_2024$TotalFedAction_2024 <- 
  gsub("\\$ ", "", Investment_state_2024$TotalFedAction_2024)

Investment_state_2024 <- Investment_state_2024 %>% 
  mutate(TotalFedAction_EnergyEnv_2024 =
           as.numeric(gsub(",", "", trimws(TotalFedAction_EnergyEnv_2024)))) %>% 
  mutate(TotalFedAction_2024 =
           as.numeric(gsub(",", "", trimws(TotalFedAction_2024)))) %>% 
  mutate(Ratio = TotalFedAction_EnergyEnv_2024 / TotalFedAction_2024,
         Year = 2024)


# Disaster
states_names <- data.frame(abbrev = states$STUSPS,
                           State = states$NAME)

disaster2024 <- disasters %>% 
  filter(fyDeclared %in% c(2024)) %>% 
  arrange(state) %>% 
  group_by(state, fipsStateCode) %>% 
  summarise(Disasters = n())

disaster2024 <- left_join(disaster2024, states_names, by = c("state" = "abbrev"))

# Public awareness
Regulate2024 <- Regulate %>% 
  select("GeoName","2024")


# Combined dataset
combined2024 <- left_join(census2024clean, Investment_state_2024,
                          by = c("State" = "stname"))

combined2024 <- left_join(combined2024, disaster2024,
                          by = c("State" = "State"))

combined2024 <- left_join(combined2024, Regulate2024,
                          by = c("State" = "GeoName"))

write.csv(combined2024, file = "Data/Processed/combined2024.csv")

```

```{r include=FALSE}
#Combine the four years
#2021
df_2021 <- combined2021 %>%
  rename(
    Total_EE_Investment = TotalFedAction_EnergyEnv_2021, 
    Political_Score = `2021`                            
  ) %>%
  mutate(Year = 2021) %>% 
  select(State, Year, Total_EE_Investment, Political_Score, Disasters, 
         `Total population`, Female, child, `Median age (years)`, 
         `Median household income (dollars)`, Gas, Electricity) 
      

# 2022
df_2022 <- combined2022 %>%
  rename(
    Total_EE_Investment = TotalFedAction_EnergyEnv_2022,
    Political_Score = `2022`
  ) %>%
  mutate(Year = 2022) %>% 
  select(State, Year, Total_EE_Investment, Political_Score, Disasters, 
         `Total population`, Female, child, `Median age (years)`, 
         `Median household income (dollars)`, Gas, Electricity)

# 2023
df_2023 <- combined2023 %>%
  rename(
    Total_EE_Investment = TotalFedAction_EnergyEnv_2023,
    Political_Score = `2023`
  ) %>%
  mutate(Year = 2023) %>% 
  select(State, Year, Total_EE_Investment, Political_Score, Disasters, 
         `Total population`, Female, child, `Median age (years)`, 
         `Median household income (dollars)`, Gas, Electricity)

# 2024
df_2024 <- combined2024 %>%
  rename(
    Total_EE_Investment = TotalFedAction_EnergyEnv_2024,
    Political_Score = `2024`
  ) %>%
  mutate(Year = 2024) %>% 
  select(State, Year, Total_EE_Investment, Political_Score, Disasters, 
         `Total population`, Female, child, `Median age (years)`, 
         `Median household income (dollars)`, Gas, Electricity)

#Merge data
final_data <- bind_rows(df_2021, df_2022, df_2023, df_2024)
write.csv(final_data, file = "Data/Processed/final_data.csv")
```

## Rationale and Research Questions

As climate change continues to intensify, federal investment in energy and environmental programs has become an important part of how states manage climate risks and build resilience. However, it is still not very clear what influences changes in this type of federal spending or why certain states receive more support than others. Understanding these patterns matters for environmental management because federal resources strongly affect a state’s ability to respond to climate impacts and plan for long term sustainability.

Recent research also shows that climate risks may influence financial decision making. For example, Marshall et al. (2021) find that climate disasters such as hurricanes or floods increase public attention to environmental issues and lead to greater investment in green financial products. They describe this as a salience effect, meaning that when climate risks become more visible, people are more willing to direct their attention and money toward environmental solutions. This idea raises an important question for our study. If climate disasters shape private investment behavior, it is reasonable to ask whether they may also influence decisions about federal energy and environmental spending.

Public attitudes may also play a role. When voters express higher concern about climate change, this can create political pressure that encourages more federal investment in environmental programs. Together, these ideas suggest that both climate risks and public opinion could help explain changes in federal spending patterns.

For these reasons, our project examines federal energy and environment investments from 2021 to 2024. This period includes several major climate events, shifts in national climate policy, and rising public awareness of environmental issues. We aim to understand how federal spending has changed during these years and what factors may be associated with these changes across states.

Our research questions are:

1.  How does federal energy and environment investment change from 2021 to 2024?

2.  What factors affect total federal energy and environment spending?

3.  Where is federal energy and environment spending being invested (i.e. where does the money go)?

Data sets used for the study are listed as follow:

| Environment and Energy Investment Data | Description                                                                                                               |
|------------------------------------|------------------------------------|
| Data Source                            | Portland State University - THE FEDERAL ENERGY AND ENVIRONMENT INVESTMENT PROJECT                                         |
| Retrieved from                         | <https://www.pdx.edu/policy-consensus-center/federal-energy-environment-investment-project>                               |
| Variables Used                         | All federal grants for a state in FY 2021 to 2024, Federal grants of energy and investment for a state in FY 2021 to 2024 |
| Date Range                             | 2021-2024                                                                                                                 |

| Demographic Data | Description                                                                                                                                  |
|------------------------------------|------------------------------------|
| Data Source      | United States Census Bureau                                                                                                                  |
| Retrieved from   | <https://www.census.gov/data/tables/time-series/demo/popest/2020s-state-total.html>                                                          |
| Variables Used   | Total population, Male, Female, Median age, Median household income, Gas, Electricity, All other fuels, No fuel used, Year, Child (age 0-17) |
| Date Range       | 2021-2024                                                                                                                                    |

| Disaster Frequency | Description                                                                  |
|------------------------------------|------------------------------------|
| Data Source        | OpenFEMA Dataset: Disaster Declarations Summaries - v2                       |
| Retrieved from     | <https://www.fema.gov/openfema-data-page/disaster-declarations-summaries-v2> |
| Variables Used     | Disasters                                                                    |
| Date Range         | 2021-2024                                                                    |

| Public Awareness on Climate Change | Description                                                                 |
|------------------------------------|------------------------------------|
| Data Source                        | Yale Program on Climate Change Communication                                |
| Retrieved from                     | <https://climatecommunication.yale.edu/visualizations-data/ycom-us/>        |
| Variables Used                     | Estimated % of adults who are somewhat or very worried about global warming |
| Date Range                         | 2021-2024                                                                   |

| Spatial Data         | Description                                                               |
|------------------------------------|------------------------------------|
| Data Source    | United States Census Bureau                                               |
| Retrieved from | <https://www2.census.gov/geo/tiger/GENZ2018/shp/cb_2018_us_state_20m.zip> |
| Variables Used | State, Geometry                                                           |
| Date Range     | 2018                                                                      |

\newpage

## Dataset Information

We selected 10 variables of interest from different data sources, from demographic characteristics, disaster frequency, and percentage of public awareness of climate change. Each annual dataset was processed and summarized in R. For every year, the resulting dataset contains 51 observations (one row per state, plus D.C.) and 12 columns (10 variables, state name and year).

The main 12 columns include:

| Column Name             | Unit   | Description                                                        |
|------------------------|------------------------|------------------------|
| Total_EE_Investment     | \$     | Federal investment (grant and loans) on energy and environment     |
| Political Score         | \%     | \% of adults who are somewhat or very worried about global warming |
| Disasters               | Count  | Number of declared disasters happened                              |
| Total Population        | People | \-                                                                 |
| Gender Ratio            | \%     | Female / total population                                          |
| Child                   | \%     | \% of people under 17 years old                                    |
| Median Age              | Age    | \-                                                                 |
| Median Household Income | \$     | \-                                                                 |
| Gas                     | \%     | \% of the people use gas as a heating fuel                                       |
| Electricity             | \%     | \% of people use electricity as a heating fuel                                |
| State                   | \-     | \-                                                                 |
| Year                    | \-     | \-                                                                 |

Below is an example summary output for the 2021 dataset, and for further analysis, dataset from each year were bound by rows, producing a final dataset of 204 objects of 10 variables.

```{r echo=FALSE, warning=FALSE}
#summary(df_2021)
#summary(final_data)

summary_2021mean <- df_2021 %>% 
  select(-Year) %>% 
  summarise(
    across(where(is.numeric),
           list(
             Mean = ~mean(.x, na.rm = TRUE)
           ),
    .names = "{.col}"
    )
  ) 
summary_2021mean <- as.data.frame(t(summary_2021mean))
summary_2021SD <- df_2021 %>% 
  select(-Year) %>% 
  summarise(
    across(where(is.numeric),
           list(
             SD = ~sd(.x, na.rm = TRUE)
           ),
    .names = "{.col}"
    )
  ) 
summary_2021SD <- as.data.frame(t(summary_2021SD))
summary_2021max <- df_2021 %>% 
  select(-Year) %>% 
  summarise(
    across(where(is.numeric),
           list(
             Max = ~max(.x, na.rm = TRUE)
           ),
    .names = "{.col}"
    )
  ) 
summary_2021max <- as.data.frame(t(summary_2021max))
summary_2021min <- df_2021 %>% 
  select(-Year) %>% 
  summarise(
    across(where(is.numeric),
           list(
             Min = ~min(.x, na.rm = TRUE)
           ),
    .names = "{.col}"
    )
  ) 
summary_2021min <- as.data.frame(t(summary_2021min))

summary_2021 <- cbind(summary_2021mean,summary_2021SD,summary_2021max,summary_2021min)
colnames(summary_2021)<- c("Mean", "Standard Deviation","Max","Min")
kable(summary_2021, caption = "Summary Table of 2021 Dataset", digits = 1)

summary_finalmean <- final_data %>% 
  select(-Year) %>% 
  summarise(
    across(where(is.numeric),
           list(
             Mean = ~mean(.x, na.rm = TRUE)
           ),
    .names = "{.col}"
    )
  ) 
summary_finalmean <- as.data.frame(t(summary_finalmean))
summary_finalSD <- final_data %>% 
  select(-Year) %>% 
  summarise(
    across(where(is.numeric),
           list(
             SD = ~sd(.x, na.rm = TRUE)
           ),
    .names = "{.col}"
    )
  ) 
summary_finalSD <- as.data.frame(t(summary_finalSD))
summary_finalMax <- final_data %>% 
  select(-Year) %>% 
  summarise(
    across(where(is.numeric),
           list(
             Max = ~max(.x, na.rm = TRUE)
           ),
    .names = "{.col}"
    )
  ) 
summary_finalMax <- as.data.frame(t(summary_finalMax))
summary_finalMin <- final_data %>% 
  select(-Year) %>% 
  summarise(
    across(where(is.numeric),
           list(
             Min = ~min(.x, na.rm = TRUE)
           ),
    .names = "{.col}"
    )
  ) 
summary_finalMin <- as.data.frame(t(summary_finalMin))

summary_final <- cbind(summary_finalmean,summary_finalSD,summary_finalMax,summary_finalMin)
colnames(summary_final)<- c("Mean", "Standard Deviation", "Max", "Min")
kable(summary_final, caption = "Summary Table of Final Dataset", digits = 1)

```

\newpage

## Exploratory Analysis

Prior to performing the regression analysis, we conducted an exploratory analysis by examining the distribution of independent variables. The [Figure 1] indicates that both federal investment amounts and disaster frequencies show a strong right-skewed distribution, with a few states having exceptionally high values compared to the majority. These skewness can violate the assumptions of Ordinary Least Squares (OLS) regression, potentially leading to heteroscedasticity and unreliable coefficient estimates. To solve this issue, we applied a logarithmic transformation to the investment (Total_EE_Investment), disaster (Disasters), and population (Total population) variables for stabilizing the variance and ensuring the robustness of statistical models.

```{r echo=FALSE, warning=FALSE, fig.cap="[figure 1: Scatter Plot]"}
#examine the normal distribution of data
cols <- c(3:12)

ggpairs(final_data, columns = cols, title = "",  
        axisLabels = "show",
        lower = list(continuous = wrap("points", size = 0.4)),
        upper = list(continuous = wrap("cor", size = 3)))+
  theme( #adjust the axis labels
    axis.text.x = element_text(size = 5),
    axis.text.y = element_text(size = 5),
    strip.text.x = element_text(size = 5),  
    strip.text.y = element_text(size = 5)
  )
```

As part of our exploration on factors driving investment, we looked at where the most natural disasters occur. If climate disasters influence investment behavior, we might expect that the states with the highest frequency of disasters to also have the greatest federal investments in the energy and environment sectors.

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.cap="[figure 2: Frequency of Natural Disasters(2021-2024)]"}
#visualize frequency of natural disasters 2021-2024
#summarize count 
disaster_count <-disasters %>% 
  filter(fyDeclared %in% c(2021, 2022, 2023, 2024)) %>% 
  arrange(state) %>% 
  group_by(state, fipsStateCode) %>% 
  summarise(Disasters = n())

disaster_count <- left_join(disaster_count, states_names, by = c("state" = "abbrev"))

#remove territories
disaster_count_clean <-disaster_count %>% 
    filter(fipsStateCode %in% c(1:56)) 
states_clean <-states %>% 
    filter(GEOID != '72', GEOID != '02', GEOID != '15') 
#note - also removed alaska and hawaii for mapping purposes


#join disaster to spatial data
states_sf_join <- states_clean %>%  
  left_join( 
    disaster_count_clean,  
    by = c("NAME" = "State")  
    ) 

#st_crs(states_sf_join) NAD83, espg 4269

#View with mapview - count of disasters
mapview(states_sf_join,  
        zcol = 'Disasters', # colors by disaster count
        col.regions = rev(brewer.pal(11, "RdBu"))) #high count in red 

#view with ggplot 
disaster_freq <- ggplot() +  
  geom_sf(data=states_sf_join,aes(fill = Disasters),alpha=0.5) +  
  scale_fill_gradient(low="lightyellow",high="red") + #high count in red 
  labs(fill='Disasters Frequency',
       title = "Disaster Frequency from 2021-2024") +
  theme(legend.position = "right")

disaster_freq #view

#save output
ggsave(
  filename = here("./Outputs/disaster_map.jpg"),
  plot = disaster_freq, 
  height = 6, 
  width = 8, 
  units = "in", 
  dpi = 300
  )

#Texas, Florida, and Louisiana have the highest declared disasters from 2021-2024
```

The map shows that Texas (n=699), Florida (n=660), and Louisiana (n=650) have the highest declared disasters from 2021-2024. The highest prevalence of natural disasters appears to be concentrated in the South region of the United States.

Next, we looked at the states that received the most federal grants and loans towards energy and environment.

```{r echo=FALSE, warning=FALSE, fig.cap="[figure 3: Total Energy and Environment Investment Map by States(2021-2024)]"}
#total federal energy/env investment map 2021-2024

#select investments from 2021-2024. 
Investment_21_24 <- Investment_state %>% 
  select("STATEFP","stname","stusps",
         "TotalFedAction_EnergyEnv_2021","TotalFedAction_EnergyEnv_2022", 'TotalFedAction_EnergyEnv_2023', 'TotalFedAction_EnergyEnv_2024')

#clean table removing $,comma, and change to numeric
Investment_21_24$TotalFedAction_EnergyEnv_2021 <- 
  as.numeric(gsub("[\\$, ]", "", Investment_21_24$TotalFedAction_EnergyEnv_2021)) 
Investment_21_24$TotalFedAction_EnergyEnv_2022 <- 
  as.numeric(gsub("[\\$, ]", "", Investment_21_24$TotalFedAction_EnergyEnv_2022))
Investment_21_24$TotalFedAction_EnergyEnv_2023 <- 
  as.numeric(gsub("[\\$, ]", "", Investment_21_24$TotalFedAction_EnergyEnv_2023))
Investment_21_24$TotalFedAction_EnergyEnv_2024 <- 
  as.numeric(gsub("[\\$, ]", "", Investment_21_24$TotalFedAction_EnergyEnv_2024))

#find sum of investment across years
Investment_21_24_clean <- Investment_21_24 %>%
  mutate(TotalFedAction_EnergyEnv_2021_2024 =
      TotalFedAction_EnergyEnv_2021 +
      TotalFedAction_EnergyEnv_2022 +
      TotalFedAction_EnergyEnv_2023 +
      TotalFedAction_EnergyEnv_2024) %>% 
  select(stusps, TotalFedAction_EnergyEnv_2021_2024)

#join investment to spatial data
investment_sf_join <- states_clean %>%  
  left_join( 
    Investment_21_24_clean,  
    by = c("STUSPS" = "stusps")  
    ) 

#View with mapview - total energy investment 2021-2024
mapview(investment_sf_join,  
        zcol = 'TotalFedAction_EnergyEnv_2021_2024', # colors by spending
        col.regions = rev(brewer.pal(11, "RdBu"))) #high spending in red 

#view with ggplot 
total_energy_investment_map <- ggplot() +  
  geom_sf(data=investment_sf_join,aes(fill = TotalFedAction_EnergyEnv_2021_2024),alpha=0.5) +  
  scale_fill_gradient(low="lightyellow",high="red") + #high count in red 
  labs(fill='Investment',
       title = "Total Federal Energy and Environment\nSpending from 2021-2024") + #line break
  theme(legend.position = "right") 

#note - removed alaska and hawaii for mapping purposes

#view map
total_energy_investment_map

#The highest spending is found in California, New York, and Texas


#save output
ggsave(
  filename = here("./Outputs/total_energy_investment_map.jpg"),
  plot = total_energy_investment_map, 
  height = 6, 
  width = 8, 
  units = "in", 
  dpi = 300
  )

```

The highest federal energy and environment investments from 2021 to 2024 were in California, New York, and Texas.

|   State    | Federal energy and environment spending |
|:----------:|:---------------------------------------:|
| California |            \$82,488,010,951             |
|  New York  |            \$54,029,205,539             |
|   Texas    |            \$45,365,375,638             |

California, New York, and Texas are among the highest populous states and are therefore expected to receive more federal investment. We next looked at the ratio of energy and environment spending compared to total federal spending across the US.

```{r echo=FALSE, warning=FALSE, fig.cap="[figure 4: Ratio of Energy and Environment Investment to Total State Budget Map(2021-2024)]"}
#Ratio of Energy investment to Total spending map 2021-2024
#select TOTAL spending from 2021-2024. 
TotalFedAction_21_24 <- Investment_state %>% 
  select("STATEFP","stname","stusps",
         "TotalFedAction_2021", "TotalFedAction_2022",
         "TotalFedAction_2023", "TotalFedAction_2024") %>% 
  mutate(across(starts_with("TotalFedAction"), 
                 ~as.numeric(gsub("[\\$, ]", "",.x))))  #clean table

#find sum of total spending across years
TotalFedAction_21_24_clean <- TotalFedAction_21_24 %>% 
  mutate(TotalFedAction_2021_2024 =
      TotalFedAction_2021 +
      TotalFedAction_2022 +
      TotalFedAction_2023 +
      TotalFedAction_2024) %>% 
  select(stusps, TotalFedAction_2021_2024)

#Join TotalFedAction_2021_2024 to spatial data
investment_sf_all <- investment_sf_join %>%
  left_join(TotalFedAction_21_24_clean, by = c("STUSPS" = "stusps"))

#calculate ratio column
investment_sf_ratio <- investment_sf_all %>% 
  mutate( 
    Ratio = TotalFedAction_EnergyEnv_2021_2024 / TotalFedAction_2021_2024)


#View with mapview - total energy investment 2021-2024
mapview(investment_sf_ratio,  
        zcol = 'Ratio', # colors by ratio of spending
        col.regions = rev(brewer.pal(11, "RdBu"))) #high spending in red 

#view with ggplot 
ratio_energy_investment_map <- ggplot() +  
  geom_sf(data=investment_sf_ratio,aes(fill = Ratio),alpha=0.5) +  
  scale_fill_gradient(low="lightyellow",high="red") + #high count in red 
  labs(fill='Investment',
       title = "Ratio of Federal Spending Invested \nin Energy and Environment 2021-2024") + #line break
  theme(legend.position = "right") 

#view map
ratio_energy_investment_map

#Out of the total federal spending, the states with the highest proportion towards Energy and Env are  DC, Wyoming, South Dakota, Montana 

#save output
ggsave(
  filename = here("./Outputs/ratio_energy_investment_map.jpg"),
  plot = ratio_energy_investment_map, 
  height = 6, 
  width = 8, 
  units = "in", 
  dpi = 300
  )

```

States with the highest ratio of spending towards energy and environment programs are DC, Wyoming, South Dakota, and Montana.

|        State         | Ratio of Federal energy and environment spending |
|:--------------------:|:------------------------------------------------:|
| District of Columbia |                       0.14                       |
|       Wyoming        |                       0.13                       |
|     South Dakota     |                       0.12                       |
|       Montanta       |                       0.11                       |

\newpage

## Analysis

### Question 1: How does federal energy and environment investment change from 2021 to 2024?

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.cap="[figure 5: ARIMA forecast (5 years) - National EE Spending(2021-2024)]",fig.align='left' }
#time series analysis
#Investment trend analysis

Investment <- Investment_state %>%
  select(
    stname,
    starts_with("TotalFedAction_EnergyEnv_"),
    starts_with("TotalFedAction_")
  ) %>%
  mutate(across(contains("FedAction"),
                ~ as.numeric(gsub("[\\$,() ]", "", .x))))

Investment_long <- Investment %>%
  pivot_longer(
    cols = -stname,
    names_to = "YearColumn",
    values_to = "Spending",
    values_drop_na = FALSE
  ) %>%
  mutate(
    Year = as.integer(str_extract(YearColumn, "\\d{4}")),
    Metric = if_else(str_detect(YearColumn, "EnergyEnv"), "EnergyEnv", "Total"),
    State = stname
  ) %>%
  select(State, Year, Metric, Spending) %>%
  arrange(State, Year, Metric)

Investment_nat <- Investment_long %>%
  group_by(Year, Metric) %>%
  summarise(Spending = sum(Spending, na.rm = TRUE), .groups = "drop")

Investment_ee_nat <- Investment_nat %>%
  filter(Metric == "EnergyEnv") %>%
  arrange(Year) %>%
  filter(Year >= min(Year, na.rm = TRUE), Year <= max(Year, na.rm = TRUE))

start_year <- min(Investment_ee_nat$Year, na.rm = TRUE)
end_year <- max(Investment_ee_nat$Year, na.rm = TRUE)
years_seq <- seq(start_year, end_year)

Investment_ee_nat_full <- tibble(Year = years_seq) %>%
  left_join(Investment_ee_nat %>% select(Year, Spending), by = "Year")

EE_ts <- ts(Investment_ee_nat_full$Spending, start = start_year, frequency = 1)

df_plot <- Investment_ee_nat_full
df_plot <- df_plot %>% mutate(Trend = as.numeric(lm(Spending ~ Year, data = df_plot)$fitted.values))
#df_plot

p_ts <- ggplot(df_plot, aes(x = Year, y = Spending)) +
  geom_line(size = 1) +
  geom_point() +
  geom_line(aes(y = Trend), color = "red", linetype = "dashed") +
  labs(x = "Year", y = "National Energy & Environment Spending",
       title = "Annual National Investment (Energy & Environment): \nobserved + linear trend") +
  theme_minimal()
print(p_ts)

lm_fit <- lm(Spending ~ Year, data = df_plot)
tbl_regression(lm_fit) %>%
  add_significance_stars()

#mk_result <- trend::mk.test(EE_ts)
#if (sum(!is.na(EE_ts)) >= 8) {
#  fit_arima <- forecast::auto.arima(EE_ts, seasonal = FALSE)
#  fcast <- forecast::forecast(fit_arima, h = 5)
#  print(fit_arima)
#  plot(fcast, main = "ARIMA forecast (5 years) - National EE Spending")
#} else {
#  message("Too few non-missing years for reliable ARIMA fitting/forecast.")
#}

#if (exists("fcast")) {
#  fcast_tbl <- tibble(
#    Year = (end_year + 1):(end_year + length(fcast$mean)),
#    Forecast = as.numeric(fcast$mean),
#    Lo80 = as.numeric(fcast$lower[ , "80%"]),
#    Hi80 = as.numeric(fcast$upper[ , "80%"]),
#    Lo95 = as.numeric(fcast$lower[ , "95%"]),
#    Hi95 = as.numeric(fcast$upper[ , "95%"])
#  )
#  print(fcast_tbl)
#}
  
```

Federal energy and environment investment shows a significant upward trend from 2021 to 2024. A linear regression of annual national spending against time indicates that investment increased by approximately \$8.17 billion per year (p = 0.0118), demonstrating a clear positive temporal relationship. This finding is reinforced by a Mann–Kendall trend test (tau = 0.503, z = 2.88, p = 0.00399), which confirms a statistically significant monotonic increase in investment over the period. Together, these results provide strong evidence that federal spending in the energy and environment sectors has grown substantially and consistently across the 2021–2024 window. Forecasts from an ARIMA model suggest that investment levels are likely to remain high in upcoming years, continuing the upward trajectory.

### Question 2: What factors affect total federal energy and environment spending?

This section investigated the drivers of federal energy and environmental investment across U.S. states in 2021, specifically examining the roles of environmental necessity (natural disasters) and political demand (public opinion).To establish a basis for our study, we first conducted a multivariable regression analysis to identify which socio-economic factors beyond just population—influence federal investment. We used AIC method to refine the model from income, gender, age, and fuel types to the most statistically relevant driver.

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.align='left'}
#Demographic Linear regression
#Some orginal data (eg. disaster) does not follow normal distribution, thus need to be log-transformed for linear regression.
log_combined2021<- combined2021%>%
  mutate(log_pop=log(`Total population`),
         log_disaster=log(Disasters),
         log_EE_investment=log(TotalFedAction_EnergyEnv_2021))

model_1 <- lm(data = log_combined2021, log_EE_investment ~ log_pop + Female + child + `Median age (years)` + `Median household income (dollars)`  + Gas + Electricity, na.action = na.exclude)

tbl_regression(model_1) %>%
  add_significance_stars()
#step(model_1)
#Among all demographic variables, Total population, electricity and median age population are significantly related to energy and environment investment

```

As expected, population was the most powerful predictor (t=17.33), explaining the vast majority of the variance in investment. This confirms that any subsequent analysis of disasters or politics must control population variable.Interestingly, Median Household Income was found to be statistically insignificant and was removed during the AIC process. This suggests that in 2021, federal energy and environmental funding was distributed relatively independently of a state's wealth.The Electricity (proportion of homes heated by electricity) and age-related variables (Median age, child) as significant or marginally significant predictors.

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.align='left'}
model_2 <- lm(data = log_combined2021, log_EE_investment ~  log_disaster, na.action = na.exclude)
tbl_regression(model_2) %>%
  add_significance_stars() #frequency of disaster is related
```

```{r echo=FALSE, fig.align='left',fig.cap="[figure 7:Correlation between Natural Disaster Frequency and Energy Investment]", message=FALSE, warning=FALSE}
plot1 <- ggplot(log_combined2021, aes(x=log_disaster, y = log_EE_investment))+
  geom_point()+
  geom_smooth(method = 'lm' )+
  ylab("Energy and Environment Investment")+
  xlab("The Frequency of Disasters across the US")
plot1
```

In Model 2, we tested whether disaster frequency alone predicts federal investment. The results indicated a statistically significant positive relationship (t = 3.616, p \< 0.001).Specifically, the coefficient of 0.24 suggests a 1% increase in disaster frequency is associated with approximately a 0.24% increase in federal investment. Furthermore, the model yielded an R-squared of 0.256, meaning that disaster frequency alone explains about 25.6% of the variance in funding allocation. While these initial findings support the hypothesis that funding is reactive to environmental needs, the low R-squared value also indicates that nearly 75% of the variation remains unexplained. This limitation, combined with the lack of demographic controls, raises the critical question of whether this correlation is truly causal or merely a reflection of population effect.

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.align='left'}
model_3 <- lm(data = log_combined2021, log_EE_investment ~ log_disaster, na.action = na.exclude)
# Public awareness is related
tbl_regression(model_3) %>%
  add_significance_stars()
```

```{r echo=FALSE, fig.align='left',message=FALSE, warning=FALSE,fig.cap="[figure 8:Public Awareness as a Determinant of Energy and Environmental Investment]"}
plot2 <- ggplot(log_combined2021, aes(x=log_disaster, y = log_EE_investment))+
  geom_point()+
  geom_smooth(method = 'lm' )+
  ylab("Energy and Environment Investment")+
  xlab(" % of people who are worried about climate change")
plot2
```

Similarly, Model 3 examined the relationship between public opinion on climate change and federal investment. The results indicated a significant positive correlation (p \< 0.05), suggesting that states with higher climate awareness tend to attract more funding.The positive coefficient indicates that a 1% increase in the climate-conscious voting base correlates with a measurable increase in federal funds. This supports the proactive funding hypothesis, where investment follows the demand for climate policy.

However, these models were limited by potential confounding factors and limited sample size. To address this, we constructed a Final Integrated Model using merged year data from 2021 to 2024.

### Question 3: Where is federal energy and environment spending being invested (i.e. where does the money go)?

The Final Integrated Model is crucial because it tests both drivers simultaneously while controlling for population. As the final result indicates, once we control for population, the frequency of the disaster effect disappears, while the political effect remains. It shows that political will is a true independent driver, whereas disaster funding is largely a function of state population.

```{r echo=FALSE, warning=FALSE,fig.align='left'}
#This codes are for the merged (2021-2024) file analysis we can either choose analysis seperately or use model below!
final_data <- final_data %>%
  mutate(
    log_pop = log(`Total population`),
    log_disaster = log(Disasters + 1), 
    log_EE_investment = log(Total_EE_Investment)
  )

final_model <- lm(data = final_data, 
                  log_EE_investment ~ log_disaster + Political_Score + log_pop + as.factor(Year))

tbl_regression(final_model) %>%
  add_significance_stars()
```

When analyzing the final merged data set (2021-2024) and controlling for population size, the influence of disaster frequency (log_disaster) became statistically insignificant (p = 0.61). This contrasts with the prior analysis and suggests that the previously observed correlation between disasters and investment was largely driven by state population.

However, political pressure on environment(Political_Score) remained a significant predictor (p < 0.05) even after controlling for population. This implies that states with a higher percentage of voters concerned about climate change actively attract more federal investment, independent of their population.

\newpage

## Summary and Conclusions

This study investigated the drivers of federal energy and environmental investment across U.S. states from 2021 to 2024 by integrating socio-economic data, disaster frequencies, and public opinion.

#### Question 1: How does federal energy and environment investment change from 2021 to 2024?
Our temporal analysis confirms a statistically significant increase in federal investment over the four-year period.The time series trend shows a consistent monotonic rise in spending, culminating in a notable surge in 2024. This trajectory reflects a structural expansion in federal support for energy and environmental initiatives, likely driven by the implementation of major policy frameworks.

#### Question 2: What factors affect total federal energy and environment spending?
The study establishes that population size is the dominant predictor of funding allocation.This suggests that federal funds are distributed broadly in proportion to the number of residents, rather than favoring wealthier states or targeting lower-income areas specifically based on income metrics.

#### Question 3: Where is federal energy and environment spending being invested (i.e. where does the money go)?
While initial bivariate analyses suggested that funding increases with natural disaster frequency, our final integrated model revealed this to be a spurious correlation driven by state size. Once population was controlled for, the influence of disasters became statistically insignificant. This implies that federal funding follows major population centers, which naturally experience higher aggregate disaster counts, rather than responding purely to the frequency of events. In contrast, political pressure (public awareness of climate change) remained a significant positive even after controlling the population variable. This confirms that political will acts as a true independent driver.

In summary, the allocation of federal energy and environmental funds from 2021 to 2024 is best characterized as demographically scaled but politically responsive. While the foundational volume of investment is determined by population size, the strategic variations above this baseline are driven by the civic demand for climate action, rather than a direct reactive response to natural disaster frequency.

\newpage

## References

Marshall, B. R., Nguyen, H. T., Nguyen, N. H., Visaltanachoti, N., & Young, M. (2021). Do climate risks matter for green investment? Journal of International Financial Markets, Institutions & Money, 75, 101438. <https://doi.org/10.1016/j.intfin.2021.101438>
